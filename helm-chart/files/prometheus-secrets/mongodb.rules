groups:
- name: mongodb
  rules:

  - alert: MongoDB replicaset member is down (State is Startup)
    expr: mongodb_rs_members_state == 0
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Startup)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Startup)"

  - alert: MongoDB replicaset member is down (State is Recovering)
    expr: mongodb_rs_members_state == 3
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Recovering)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Recovering)"

  - alert: MongoDB replicaset member is down (State is Startup2)
    expr: mongodb_rs_members_state == 5
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Startup2)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Startup2)"

  - alert: MongoDB replicaset member is down (State is Unknown)
    expr: mongodb_rs_members_state == 6
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Unknown)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Unknown)"

  - alert: MongoDB replicaset member is down (State is Down)
    expr: mongodb_rs_members_state == 8
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Down)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Down)"

  - alert: MongoDB replicaset member is down (State is Rollback)
    expr: mongodb_rs_members_state == 9
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Rollback)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Rollback)"

  - alert: MongoDB replicaset member is down (State is Removed)
    expr: mongodb_rs_members_state == 10
    for: 2m
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State is Removed)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State is Removed)"
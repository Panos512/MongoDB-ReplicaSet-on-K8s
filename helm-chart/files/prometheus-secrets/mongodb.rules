groups:
- name: mongodb
  rules:

  - alert: MongoDB replicaset member is down (State: Startup)
    expr: mongodb_rs_members_state == 0
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Startup)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Startup)"

  - alert: MongoDB replicaset member is down (State: Recovering)
    expr: mongodb_rs_members_state == 3
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Recovering)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Recovering)"

  - alert: MongoDB replicaset member is down (State: Startup2)
    expr: mongodb_rs_members_state == 5
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Startup2)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Startup2)"

  - alert: MongoDB replicaset member is down (State: Unknown)
    expr: mongodb_rs_members_state == 6
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Unknown)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Unknown)"

  - alert: MongoDB replicaset member is down (State: Down)
    expr: mongodb_rs_members_state == 8
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Down)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Down)"

  - alert: MongoDB replicaset member is down (State: Down)
    expr: mongodb_rs_members_state == 8
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Down)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Down)"

  - alert: MongoDB replicaset member is down (State: Rollback)
    expr: mongodb_rs_members_state == 9
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Rollback)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Rollback)"

  - alert: MongoDB replicaset member is down (State: Removed)
    expr: mongodb_rs_members_state == 10
    for: 15s
    labels:
      severity: high
      tag: cmsweb
      service: mongodb
      host: "{{ $labels.member_idx }}"
      kind: database
      action: Please check MongoDB on {{ $labels.member_idx }}
    annotations:
      summary: "mongodb replica member with hostname {{ $labels.member_idx }} ( {{ $labels.member_state }} ) is down (State: Removed)"
      description: "Replica member with hostname {{ $labels.member_idx }} has been down for more than 2m (State: Removed)"